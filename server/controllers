const customer = require('../models/customer');
const mongoose = require('mongoose');
const flash = require('connect-flash');


exports.homepage =async(req,res)=>{
 
    // const messages = await req.consumeFlash('info');

    const locals = {
        title: 'NodeJs',
        description: 'Free User Management course'
    }

    let perPage = 12;
    let page = req.query.page || 1;

    try {
        const customers = await customer.aggregate([ { $sort: {updateAt: -1 } } ])
        .skip(perPage*page-perPage)
        .limit(perPage)
        .exec();

        const count = await customer.count();

        res.render('index',{ 
        locals,
        customers,
        current: page,
        pages: Math.ceil(count/perPage)
     });
     
    } catch (error) {
        console.log(error);
    }

}

exports.addCustomer =async(req,res)=>{
    
    const locals = {
        title: 'ADD New Customer',
        description: 'Free User Management course'
    }

    res.render('customer/add',locals);
}
